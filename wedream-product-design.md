# “唯梦 (wedream)” 产品架构与核心逻辑设计文档

本文档旨在回归第一性原理，深入梳理“唯梦”社交平台的核心产品逻辑、用户流程和系统架构。我们将优先定义 **“做什么”**，为后续的技术实现提供清晰、稳固的蓝图。

---
# 注意我们的产品设计稿要以figma为基础，进行设计，调用figma mcp进行阅读。
# 产品设计稿链接：https://www.figma.com/design/ODUF8MEfpgsNWClQKR8YbV/Modern-Social-Media-web-Design--Community-?t=bBAsxwpdOc2hJbeC-0

## 1. 核心愿景与第一性原理

-   **核心愿景**: “唯梦”是一个让用户记录、分享并以视觉化形式（AI生成图片/视频）重现梦境的社交平台。它连接了个人内在世界与外部社交分享。
-   **第一性原理**:
    1.  **记录**: 用户必须有一个简单、私密的工具来记录梦境文字。
    2.  **创生**: 系统必须能将梦境文字**转换**为引人入胜的视觉内容。这是产品的“魔法时刻”。
    3.  **分享**: 用户可以轻松地将生成的视觉内容分享到公共空间（大厅）。
    4.  **社交**: 其他用户可以发现、欣赏并围绕分享的梦境进行互动（点赞、评论、关注）。

---

## 2. 核心用户旅程 (User Journey)

下图描绘了新用户从进入平台到完成一次核心体验的完整流程。

```mermaid
flowchart TD
    A(开始) --> B[访问网站];
    B --> C{有无账号?};
    C -- 无 --> D[注册页面];
    D --> E[登录页面];
    C -- 有 --> E;
    E --> F[主页/大厅 (Feed)];
    F -- 浏览梦境 --> F;
    F --> G[点击“记录梦境”按钮];
    
    subgraph "核心功能：引导式共创 (Guided Co-creation)"
        G --> H[发布页面: 梦境描述];
        H -- 1. 用户输入原始描述 --> I{2. 后端LLM分析};
        I --> I1[分析核心意图];
        I --> I2[生成优化后的视觉Prompt];
        I2 -- 存储 --> BackendSession[(后端会话)];
        I1 --> J[3. 前端展示意图确认<br>“你的梦里有'巨鲸'和'浮空城'，对吗?”];
        J --> K{4. 用户确认};
        K -- "不对" --> H;
        K -- "是的" --> L[5. 后端触发视觉生成];
        L -- 使用已存Prompt --> M[AI视觉模型生成多个结果];
        M --> N[6. 前端画廊式展示多个结果];
        N --> O{7. 用户选择};
        O -- "都不满意" --> L;
        O -- "选中一个" --> P[8. 成功，点击发布];
    end
    
    P --> Q[发布成功, 帖子出现在大厅];
    O --> F;
    
    F -- 点击其他用户头像 --> P[他人个人主页];
    F -- 点击自己头像 --> Q[我的个人主页];
    F -- 点击消息图标 --> R[聊天/消息页面];
```

---

## 3. 系统架构总览

系统将采用前后端分离的架构，便于独立开发、扩展和维护。

```mermaid
graph TD
    User[用户] <--> FE[前端 (Next.js)];

    subgraph "后端 (Python + FastAPI)"
        API[API 网关];
        Auth[用户认证服务];
        Dream[梦境帖子服务];
        Social[社交关系服务];
        Chat[实时聊天服务];
        AI_GW[AI生成网关];
    end
    
    subgraph "第三方/底层服务"
        DB[(数据库 - PostgreSQL/MongoDB)];
        AI[AI视觉生成服务 (Midjourney/Stable Diffusion API)];
        WS[WebSocket 服务];
    end
    
    FE -- HTTPS --> API;
    API -- 分发 --> Auth;
    API -- 分发 --> Dream;
    API -- 分发 --> Social;
    FE -- WebSocket --> Chat;

    Auth -- 读写 --> DB;
    Dream -- 读写 --> DB;
    Social -- 读写 --> DB;
    Chat -- 读写 --> DB;
    Chat -- 依赖 --> WS;
    
    Dream -- 调用 --> AI_GW;
    AI_GW -- 调用 --> AI;
```

---

## 4. 关键页面与模块设计

### 4.1. 主页/大厅 (Feed) - `app/page.tsx`
-   **目标**: 梦境的发现与消费中心，类似X的Timeline。
-   **布局**: 采用三栏布局，灵感源自Figma `Desktop 1` 和 X。
    -   **左栏**: 导航栏（主页、探索、通知、消息、个人主页、发布按钮）。
    -   **中栏**: 核心内容区域。无限滚动的梦境卡片列表。每个卡片包含用户头像、用户名、梦境视觉内容（图片/视频）、梦境原文（可选择展开）、点赞/评论/分享按钮。
    -   **右栏**: 个人信息摘要、推荐关注用户、热门话题等。

### 4.2. 🌟 发布页面 (重点设计) - `app/dream/create/page.tsx`
-   **目标**: 打造“引导式共创”的魔法时刻，让用户与AI对话，共同将梦境转化为艺术。
-   **UI与流程 (新版)**:
    1.  **输入区**: 用户输入原始、未经修饰的梦境描述。
    2.  **首次生成**: 用户点击“解梦”。后端LLM介入，完成两件事：
        - **意图分析**: 提炼出核心视觉元素。
        - **提示词生成**: 创建一个优化过的、结构化的视觉提示词（Prompt），并将其**存储在后端会话中**。
    3.  **意图确认**: 前端收到LLM分析出的“核心意图”，并以对话形式呈现给用户（例如：“我看到你的梦里有'一只巨大的鲸鱼'和'一座漂浮的城市'，是这样吗？”）。下方提供“是的，继续”和“不对，我修改一下”两个按钮。
    4.  **视觉生成**: 用户确认意图后，前端通知后端。后端直接使用已存储的提示词，调用AI视觉生成模型，并要求其**一次性生成多个（例如4个）结果**。
    5.  **画廊选择**: 前端收到多个视觉结果后，以画廊（Grid）的形式展示出来。
    6.  **选择与发布**: 用户可以从多个结果中选择最满意的一个。如果都不满意，可以点击“换一批”按钮，后端会再次调用视觉生成模型。选中满意的作品后，用户点击“发布”，作品被分享。

### 4.3. 个人主页 - `app/[username]/page.tsx`
-   **目标**: 展示用户的个人信息和其发布的所有梦境。
-   **布局**:
    -   顶部: 用户头像、背景图、用户名、简介、关注/粉丝数、关注/编辑按钮。
    -   内容区: 以网格布局展示该用户发布的所有梦境视觉内容，点击可进入详情页。

### 4.4. 聊天/消息页面 - `app/messages/page.tsx`
-   **目标**: 提供用户间一对一的私密交流渠道。
-   **布局**: 经典的双栏布局。左侧为联系人列表，右侧为当前聊天窗口。

---

## 5. 高层数据模型

-   **User**: `id`, `username`, `email`, `password_hash`, `avatar_url`, `profile_bio`
-   **DreamPost**: `id`, `author_id`, `dream_text`, `ai_prompt`, `generated_image_url`, `generated_video_url`, `created_at`
-   **Comment**: `id`, `post_id`, `author_id`, `content`, `created_at`
-   **Like**: `user_id`, `post_id`
-   **Follow**: `follower_id`, `following_id`

---

## 6. 下一步行动

1.  请您审阅这份产品设计文档。
2.  若您认可此设计，我将基于此文档创建一份精确、可执行的 **前端静态Demo开发TODO-List**。
3.  在您批准TODO-List后，我将请求切换至“代码”模式，开始进行编码。